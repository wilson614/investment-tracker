# Implementation Plan: Currency Ledger UI Redesign

**Branch**: `001-portfolio-tracker` | **Date**: 2026-01-09 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification update from `/specs/001-portfolio-tracker/spec.md`

**Note**: This plan covers the UI redesign changes for Currency Ledger based on spec updates from Session 2026-01-09.

## Summary

Redesign the Currency Ledger UI to better serve its primary purpose: **tracking foreign currency holdings for stock investments** (not currency trading). Key changes:

1. Remove meaningless metrics (Current Cost, Realized PnL)
2. Restructure display to show real-time exchange rate alongside currency code
3. Keep user-initiated ledger creation (one ledger per currency)
4. Remove ledger name editing (system auto-names based on currency)

## Technical Context

**Language/Version**: C# .NET 8 (Backend), TypeScript 5.x (Frontend)
**Primary Dependencies**: ASP.NET Core 8, Entity Framework Core, React 18, Vite, TanStack Query
**Storage**: SQLite (development), PostgreSQL (production-compatible)
**Testing**: xUnit (backend), Vitest (frontend)
**Target Platform**: Web (Docker-deployable)
**Project Type**: Web application (backend + frontend)
**Performance Goals**: Page load <3s, quote fetch <5s (SC-005, SC-008)
**Constraints**: Self-hosted friendly (<512MB RAM idle)
**Scale/Scope**: Family use (~10 users)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Clean Architecture | ✅ Pass | UI-only changes, no domain layer impact |
| II. Multi-Tenancy | ✅ Pass | No change to data isolation |
| III. Accuracy First | ✅ Pass | No change to financial calculations |
| IV. Self-Hosted Friendly | ✅ Pass | No new dependencies |
| V. Technology Stack | ✅ Pass | Using existing React/TypeScript stack |

## Project Structure

### Documentation (this feature)

```text
specs/001-portfolio-tracker/
├── plan.md              # This file
├── spec.md              # Updated spec with Currency Ledger redesign
└── tasks.md             # To be generated by /speckit.tasks
```

### Source Code (affected files)

```text
frontend/
├── src/
│   ├── components/
│   │   └── currency/
│   │       └── CurrencyLedgerCard.tsx    # Redesign card layout
│   └── pages/
│       ├── Currency.tsx                   # Update overview metrics
│       └── CurrencyDetail.tsx             # Restructure header & metrics
```

**Structure Decision**: Existing web application structure. Changes are isolated to frontend Currency components.

## Change Summary

### Changes Required

| File | Change Type | Description |
|------|-------------|-------------|
| `Currency.tsx` | Modify | Remove 目前成本, 已實現損益 from summary; keep 淨投入 |
| `CurrencyLedgerCard.tsx` | Redesign | Show USD @ rate format; remove cost/PnL; add TWD equivalent |
| `CurrencyDetail.tsx` | Modify | Move exchange rate to header; remove name editing; remove cost/PnL metrics |

### Metrics to Display

**Currency Overview Page (`/currency`):**
- Summary: 淨投入 only (remove 目前成本, 已實現損益, 利息收入 from summary)

**Currency Ledger Card:**
- Header: Currency code + real-time rate (e.g., "USD @ 32.15")
- Balance (large)
- TWD equivalent (Balance × Current Rate)
- 淨投入
- 換匯均價
- 利息收入 (only if > 0)
- ❌ Remove: 目前成本, 已實現損益

**Currency Detail Page (`/currency/:id`):**
- Header: Currency code + real-time rate + refresh button (NOT editable)
- Metrics: Balance, Average Rate, Net Investment
- ❌ Remove: Name editing, Current Cost, Realized PnL cards

### Data Model

No database changes required. All changes are UI-only.

The backend already provides all necessary fields in `CurrencyLedgerSummary`:
- `balance` ✅
- `averageExchangeRate` ✅
- `totalExchanged` (淨投入) ✅
- `totalInterest` ✅
- `totalCost` - will stop displaying
- `realizedPnl` - will stop displaying

## Implementation Steps

### Step 1: Update Currency Overview Page

**File**: `frontend/src/pages/Currency.tsx`

1. Remove `totalCost` calculation and display
2. Remove `totalRealizedPnl` calculation and display
3. Keep `totalExchanged` (淨投入) as the only summary metric
4. Optionally remove or keep `totalInterest` based on user preference

### Step 2: Redesign Currency Ledger Card

**File**: `frontend/src/components/currency/CurrencyLedgerCard.tsx`

1. Restructure header to show "USD @ 32.15" format
2. Add real-time exchange rate fetching per card
3. Show balance prominently with TWD equivalent below
4. Show 淨投入, 換匯均價
5. Show 利息收入 only if > 0
6. Remove 目前成本, 已實現損益 sections

### Step 3: Update Currency Detail Page

**File**: `frontend/src/pages/CurrencyDetail.tsx`

1. Move exchange rate display to header next to currency code
2. Remove name editing functionality (isEditingName, handleSaveName, etc.)
3. Remove "Current Cost" metric card
4. Remove "Realized PnL" metric card
5. Keep: Balance, Average Rate, Net Investment

## Complexity Tracking

No constitution violations. All changes are UI simplifications that reduce complexity.

## Next Steps

Run `/speckit.tasks` to generate detailed implementation tasks.
